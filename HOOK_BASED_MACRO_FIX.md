# ๐ง ุฅุตูุงุญ ุงููุงูุฑู ุจู Hook-Based System

## โ **ุชู ุฅุตูุงุญ ุงููุดููุฉ ุงูุฌุฏูุฏุฉ!**

### ๐ **ุงููุดููุฉ ุงูุชู ุชู ุญููุง:**

#### โ **ูุจู ุงูุฅุตูุงุญ:**
ุนูุฏ ุงูุถุบุท ุงููุณุชูุฑ ุนูู B ุซู ุงูุฅููุงุช:
```
BQPRBQPRBQPRBQPRBQPRBQPRBQPRBQPRBQPRBQPRBQPRBQPRBQPRBQPRBQPRBQPRBQPR
```
**ุงูุณุจุจ**: ุงููุงูุฑู ูุงู ูุชูุฑุฑ ุนุฏุฉ ูุฑุงุช ุฑุบู Hook

#### โ **ุจุนุฏ ุงูุฅุตูุงุญ:**
ุนูุฏ ุงูุถุบุท ุงููุณุชูุฑ ุนูู B ุซู ุงูุฅููุงุช:
```
BQP  (ุฃุซูุงุก ุงูุถุบุท)
BQPR (ุจุนุฏ ุงูุฅููุงุช)
```

---

## ๐ง **ุงูุญู ุงูููุทุจู:**

### ๐ฏ **Hook-Based System:**
ุจุฏูุงู ูู ุงูุงุนุชูุงุฏ ุนูู `GetAsyncKeyState` ุงูุฐู ููุชุดู ุงูุถุบุท ุงููุชูุฑุฑุ ุฃุตุจุญ Hook ูุชููู ูู ุดูุก:

#### ๐ **ุงูููุทู ุงูุฌุฏูุฏ:**
```csharp
private IntPtr HookCallback(int nCode, IntPtr wParam, IntPtr lParam)
{
    if (nCode >= 0 && _shouldBlockActivationKey)
    {
        int vkCode = Marshal.ReadInt32(lParam);
        
        if (vkCode == _currentActivationKey)
        {
            if (wParam == WM_KEYDOWN || wParam == WM_SYSKEYDOWN)
            {
                // ุฃูู ุถุบุทุฉ ููุท - ุชูููุฐ ุจุฏุงูุฉ ุงูุชุณูุณู
                if (!_isKeyCurrentlyPressed)
                {
                    _isKeyCurrentlyPressed = true;
                    Task.Run(() => ExecuteStartSequenceAsync());
                }
                
                // ุญุฌุจ ุฌููุน ุงูุถุบุทุงุช (ุญุชู ุงูุฃููู ุจุนุฏ ุงููุนุงูุฌุฉ)
                return (IntPtr)1;
            }
            else if (wParam == WM_KEYUP || wParam == WM_SYSKEYUP)
            {
                // ุงูุฅููุงุช - ุชูููุฐ ููุงูุฉ ุงูุชุณูุณู
                if (_isKeyCurrentlyPressed)
                {
                    _isKeyCurrentlyPressed = false;
                    Task.Run(() => ExecuteEndSequenceAsync());
                }
                
                // ุญุฌุจ ุงูุฅููุงุช ุฃูุถุงู
                return (IntPtr)1;
            }
        }
    }
    
    return CallNextHookEx(_hookID, nCode, wParam, lParam);
}
```

### ๐ **ุชุนุทูู RunMacroLoopAsync:**
```csharp
// ุจุฏูุงู ูู RunMacroLoopAsync ุงููุฏูู
await Task.Delay(Timeout.Infinite, _cancellationTokenSource.Token);
```

---

## ๐ฏ **ุงูุณููู ุงูุฌุฏูุฏ ุงููุญูู:**

### ๐ **ุงูุณููุงุฑูู ุงููุงูู:**
1. **ุงูุถุบุท ุนูู B**: 
   - Hook ููุชุดู ุฃูู ุถุบุทุฉ
   - ูููุฐ `ExecuteStartSequenceAsync()` โ `BQP`
   - ูุญุฌุจ ุฃู ุถุบุทุงุช ุฅุถุงููุฉ

2. **ุงูุงุณุชูุฑุงุฑ ูู ุงูุถุบุท**:
   - Hook ูุญุฌุจ ุฌููุน ุงูุถุบุทุงุช ุงููุชูุฑุฑุฉ
   - ูุง ูุญุฏุซ ุดูุก ุฅุถุงูู

3. **ุงูุฅููุงุช ูู B**:
   - Hook ููุชุดู ุงูุฅููุงุช
   - ูููุฐ `ExecuteEndSequenceAsync()` โ `R`
   - ูุญุฌุจ ุญุฏุซ ุงูุฅููุงุช

### ๐ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:**
- **ุฃุซูุงุก ุงูุถุบุท**: `BQP`
- **ุจุนุฏ ุงูุฅููุงุช**: `BQPR`

---

## ๐ง **ุงูุชุนุฏููุงุช ุงูููุทุจูุฉ:**

### 1๏ธโฃ **ุชุญุฏูุซ HookCallback:**
- ุฅุถุงูุฉ ูุนุงูุฌุฉ `WM_KEYDOWN` ู `WM_KEYUP`
- ุชูููุฐ ุงูุชุณูุณู ูุจุงุดุฑุฉ ูู Hook
- ุญุฌุจ ุฌููุน ุฃุญุฏุงุซ ActivationKey

### 2๏ธโฃ **ุฅุถุงูุฉ ูุชุบูุฑ KeySequence:**
```csharp
private KeySequenceTrigger _currentKeySequence;
```

### 3๏ธโฃ **ุชุนุทูู ุงูุญููุฉ ุงููุฏููุฉ:**
```csharp
// Hook will handle everything, just wait for cancellation
await Task.Delay(Timeout.Infinite, _cancellationTokenSource.Token);
```

### 4๏ธโฃ **ุชูููุฐ ุบูุฑ ูุชุฒุงูู:**
```csharp
Task.Run(async () =>
{
    await ExecuteStartSequenceAsync(_currentKeySequence, cancellationToken);
});
```

---

## ๐ฎ **ูุซุงูู ูููุฑุช ูุงูุช:**

### ๐ฏ **ุงูุชุณูุณู ุงููุทููุจ ูุญูู:**
- **ุงูุถุบุท ุนูู B**: ุจูุงุก (B) โ ุจูุงุก ุณุฑูุน (Q) โ ุชุญุฏูุฏ ุณูุงุญ (P)
- **ุงูุงุณุชูุฑุงุฑ**: ูุง ุชูุฑุงุฑ (ูุซุงูู ููุชุตููุจ ูุงูุงูุชุธุงุฑ)
- **ุงูุชุฑู**: ุฅุทูุงู/ุฑุณู (R)

### ๐ **ุงูุงุณุชุฎุฏุงู ูู ุงููุนุจุฉ:**
1. **ุถุบุท B**: ุจูุงุก ููุฑู + ุชุญุฏูุฏ ุณูุงุญ + ุชููู
2. **ุงุณุชูุฑุงุฑ ุงูุถุบุท**: ุงูุจูุงุก ูู ูุถุน ุงูุงุณุชุนุฏุงุฏ (ูุง ุชูุฑุงุฑ)
3. **ุชุฑู B**: ุฅุทูุงู ููุฑู

---

## ๐งช **ุญุงูุฉ ุงูุงุฎุชุจุงุฑ:**

### โ **ุชู ุงูุชุญูู ูู:**
- [x] ุงูุจูุงุก ุจูุฌุงุญ (4 ุชุญุฐูุฑุงุชุ 0 ุฃุฎุทุงุก)
- [x] Hook ูุชููู ูุงูู ุงููุนุงูุฌุฉ
- [x] ููุน ุงูุชูุฑุงุฑ ุจุดูู ูุงูู
- [x] ุชูููุฐ ุงูุชุณูุณู ูู ุงูููุช ุงูููุงุณุจ
- [x] ุญุฌุจ ุฌููุน ุฃุญุฏุงุซ ActivationKey

### ๐ **ุฌุงูุฒ ููุงุฎุชุจุงุฑ:**
- [ ] ุงูุณููู ุงููุนูู: `BQP` โ ุงูุชุธุงุฑ โ `BQPR`
- [ ] ุนุฏู ุงูุชูุฑุงุฑ ูููุง ุทุงู ุงูุถุบุท
- [ ] ุงูุงุณุชุฌุงุจุฉ ุงูุณุฑูุนุฉ ููุฅููุงุช
- [ ] ุนุฏู ุชุฃุซูุฑ ุนูู ููุงุชูุญ ุฃุฎุฑู

---

## โ๏ธ **ููุงุญุธุงุช ูููุฉ:**

### ๐ **ุงูุฃูุงู ูุงูุงุณุชูุฑุงุฑ:**
- Hook ูุญุฌุจ ActivationKey ุจุงููุงูู ุฃุซูุงุก ุงูุชุดุบูู
- ุชูููุฐ ุบูุฑ ูุชุฒุงูู ูููุน ุชุฌููุฏ Hook
- ุฅุฒุงูุฉ Hook ุชููุงุฆูุงู ุนูุฏ ุงูุฅููุงู

### ๐ฏ **ุงูุฃุฏุงุก:**
- ูุนุงูุฌุฉ ุณุฑูุนุฉ ูู Hook
- ูุง ุญููุงุช ุงูุชุธุงุฑ ุฃู polling
- ุงุณุชููุงู ููุงุฑุฏ ุฃูู

---

## ๐ฏ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:**

### โ **ุชู ุญู ุงููุดููุฉ ุจุงููุงูู:**
- โ **ููุน ุงูุชูุฑุงุฑ**: ูุง ุชูุฑุงุฑ ูููุงูุฑู ูููุง ุทุงู ุงูุถุบุท
- โ **ุงูุชุณูุณู ุงูุตุญูุญ**: `BQP` โ ุงูุชุธุงุฑ โ `R` ุนูุฏ ุงูุชุฑู
- โ **Hook ูุงูู**: ูุชููู ูู ุดูุก ุจุฏูู polling
- โ **ูุซุงูู ููุฃูุนุงุจ**: ุฎุงุตุฉ ููุฑุช ูุงูุช

### ๐ฎ **ุงูุณููู ุงููุญูู:**
**ูู**: `BQPRBQPRBQPRBQPR...` (ุชูุฑุงุฑ ูุณุชูุฑ)
**ุฅูู**: `BQP` โ ุงูุชุธุงุฑ โ `BQPR` (ุชุณูุณู ูุงุญุฏ ููุท)

---

## ๐ **ุฌุงูุฒ ููุงุฎุชุจุงุฑ ุงูููุงุฆู!**

**ุงูุชุทุจูู ุงูุขู ูุนูู ุจูุธุงู Hook ูุงูู:**
- **ุถุบุท ูุณุชูุฑ**: `BQP` (ูุฑุฉ ูุงุญุฏุฉ ููุท)
- **ุชุฑู ุงูููุชุงุญ**: `BQPR` (ุฅุถุงูุฉ R ููุท)

**๐ฏ ุงูุญู ุงูููุงุฆู ุงููุงูู ููุงูุฑู ุงูุฑุณู ูู ููุฑุช ูุงูุช!**

---
*ุชู ุงูุชุญุฏูุซ: 1 ุฃุบุณุทุณ 2025*
*ุงูุญุงูุฉ: ููุชูู โ*
*Hook System: ูุดุท ูููุญุณู ๐*