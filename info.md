# SR3H MACRO - ุฏููู ุงููุดุฑูุน ุงูุดุงูู

**ุขุฎุฑ ุชุญุฏูุซ**: 2025-12-21 (Session 30 Portion 2) | **ุงูุญุงูุฉ**: ููุฏ ุงูุชุทููุฑ ุงููุดุท (ูุญูู ููุท)

---

## ๐ ุงููุญุชููุงุช
1. [ูุธุฑุฉ ุนุงูุฉ](#ูุธุฑุฉ-ุนุงูุฉ)
2. [ุญุงูุฉ ุงููุดุฑูุน](#ุญุงูุฉ-ุงููุดุฑูุน)
3. [ุงููุนูุงุฑูุฉ ูุงูุชูููููุฌูุง](#ุงููุนูุงุฑูุฉ-ูุงูุชูููููุฌูุง)
4. [ูุนูููุงุช ุงูุงุชุตุงู ูุงูุฎูุงุฏู](#ูุนูููุงุช-ุงูุงุชุตุงู-ูุงูุฎูุงุฏู)
5. [ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช](#ูููู-ูุงุนุฏุฉ-ุงูุจูุงูุงุช)
6. [ุงูููุฒุงุช ุงููููุฐุฉ](#ุงูููุฒุงุช-ุงููููุฐุฉ)
7. [ุขุฎุฑ ุงูุชุญุฏูุซุงุช](#ุขุฎุฑ-ุงูุชุญุฏูุซุงุช)
8. [ุงููููุงุช ุงูุฑุฆูุณูุฉ](#ุงููููุงุช-ุงูุฑุฆูุณูุฉ)
9. [ุฃูุงูุฑ ุงูุจูุงุก ูุงูุงุฎุชุจุงุฑ](#ุฃูุงูุฑ-ุงูุจูุงุก-ูุงูุงุฎุชุจุงุฑ)
10. [ุงูุฎุทูุงุช ุงูุชุงููุฉ](#ุงูุฎุทูุงุช-ุงูุชุงููุฉ)
11. [ููุงุญุธุงุช ุชูููุฉ ูููุฉ](#ููุงุญุธุงุช-ุชูููุฉ-ูููุฉ)

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

| ูุนูููุฉ | ุงูุชูุงุตูู |
|--------|----------|
| **ุงุณู ุงููุดุฑูุน** | SR3H MACRO |
| **ุงููุฏู** | ุชุทุจูู ูุงูุฑู Fortnite ูุน ูุธุงู ุชูุนูู ููู ูุฅุฏุงุฑุฉ ุงุดุชุฑุงูุงุช |
| **ุงููุบุฉ** | C# .NET 9 (WPF) |
| **ูุงุนุฏุฉ ุงูุจูุงูุงุช** | PostgreSQL (Supabase) |
| **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู** | Zoho SMTP |
| **ุงููุนูุงุฑ** | Railway Proxy (ุฌุณุฑ ุขูู) |
| **ุญุงูุฉ ุงูุชุทููุฑ** | ููุฏ ุงูุชุทููุฑ ุงููุดุท |

---

## ๐ ุญุงูุฉ ุงููุดุฑูุน

### ููุฎุต ุงูุญุงูุฉ ุงูุญุงููุฉ
- โ ูุธุงู ุงูุชูุนูู ุงูุฃุณุงุณู: ููุชูู
- โ ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงูุงุช: ูุชูุฏูุฉ
- โ ุงูุชุญูู ุนุจุฑ OTP: ูุณุชูุฑ
- โ ุฃูุงู ุงูุชุฌุฑุจุฉ ุงููุฌุงููุฉ (hardware_id-based): ูุณุชูุฑ
- โ ููุน ุงูุณุจุงู: **ููู ูู ุงูุฐุงูุฑุฉ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช** (Session 22 - ุฌุฏูุฏ)
- โณ ุงูุงุฎุชุจุงุฑ ุงูุดุงูู: ููุฏ ุงูุชูุฏู

### ูุณุจุฉ ุงูุฅููุงู
- ูุนูุงุฑูุฉ ุงููุธุงู: **99%** โฌ๏ธ (ูู 97% - Session 28 โ Session 30 P2)
- ุงูููุฒุงุช ุงูุฃุณุงุณูุฉ: **95%** โ (ูุณุชูุฑ)
- ุงูุฃูุงู: **100%** โฌ๏ธ (ูู 94% - Session 30 P2: ุฃูุงู ุดุงูู ููุญูู)
- ุงููุซุงุฆู: **85%** โฌ๏ธ (ูู 78% - Session 30 P2)

---

## ๐๏ธ ุงููุนูุงุฑูุฉ ูุงูุชูููููุฌูุง

### ุงูููููุงุช ุงูุฑุฆูุณูุฉ
```
ุชุทุจูู ุงููุณุชุฎุฏู (WPF)
    โ
[MacroFortActivationService]  โ ุฎุฏูุฉ ุงูุชูุนูู ุงูุฑุฆูุณูุฉ
    โ
[Railway Proxy] โ ุฌุณุฑ ุขูู
    โ
[Supabase/PostgreSQL] โ ูุงุนุฏุฉ ุงูุจูุงูุงุช
    โ
[Zoho SMTP] โ ุฎุฏูุฉ ุงูุจุฑูุฏ
```

### ุงูุฎุฏูุงุช ุงูุฎุงุฑุฌูุฉ
| ุงูุฎุฏูุฉ | ุงูููุน | ุงููุตู | ุงูุญุงูุฉ |
|---------|-------|--------|--------|
| **Supabase** | Database | PostgreSQL ููุฏุงุฑ | โ ูุดุท |
| **Railway** | API Gateway | ุฌุณุฑ ุขูู ููู API | โ ูุดุท |
| **Zoho SMTP** | Email | ุฅุฑุณุงู ุฑุณุงุฆู ุชุญูู | โ ูุดุท |

---

## ๐ ูุนูููุงุช ุงูุงุชุตุงู ูุงูุฎูุงุฏู

### Railway Proxy (ุงูุฌุณุฑ ุงูุขูู)
```
URL: https://sr3h-auth-proxy-production.up.railway.app
ุงููุฏู: ุชูููุฑ ูุงุฌูุฉ ุขููุฉ ููุชูุงุตู ูุน Supabase
ุงููุตุงุฏูุฉ: Bearer Token + API Key
ุงูุทุฑููุฉ: HTTP POST/GET/PATCH
ุงูุชุญููู: HTTP โ REST API Supabase
```

### ูุชุบูุฑุงุช ุงูุจูุฆุฉ (Environment Variables)
โ๏ธ **ูุง ุชุถุน ุงูููู ุงููุนููุฉ ููุง - ุงุณุชุฎุฏู System Environment Variables ููุท**

```
ูุฌุจ ุชุนููู ูู Windows:
1. SUPABASE_SERVICE_ROLE_KEY  โ ููุชุงุญ ุฎุฏูุฉ Supabase
2. ZOHO_EMAIL                 โ ุจุฑูุฏ Zoho ุงูุฅุฑุณุงูู
3. ZOHO_APP_PASSWORD          โ ูููุฉ ุชุทุจูู Zoho

ุงูุทุฑููุฉ:
setx SUPABASE_SERVICE_ROLE_KEY "your_key_here"
setx ZOHO_EMAIL "your_email@zoho.sa"
setx ZOHO_APP_PASSWORD "your_password_here"
```

### ุฑูุงุจุท ูููุฉ
- ๐ **Supabase Dashboard**: https://app.supabase.com (ูุงุนุฏุฉ ุงูุจูุงูุงุช)
- ๐ **Railway Dashboard**: https://railway.app (ุงูู Proxy)
- ๐ **Railway Proxy Repository**: https://github.com/anamsmmy/sr3h-auth-proxy (Gateway ููุท)
- ๐ง **Zoho Mail Admin**: https://mail.zoho.sa (ุงูุจุฑูุฏ ุงูุฅููุชุฑููู)
- ๐ป **SR3H MACRO**: ุชุทููุฑ ูุญูู ููุท (ูุง GitHub - ุนููู ูุญูู ุขูู ุจุฏูู ููุงุชูุญ)

---

## ๐พ ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู ุงูุซูุงุซุฉ ุงูุฑุฆูุณูุฉ

#### 1๏ธโฃ `macro_fort_subscriptions` (ุงูุงุดุชุฑุงูุงุช)
```sql
ุงูุญููู ุงูุฑุฆูุณูุฉ:
- id (UUID)                          - ูุนุฑู ูุฑูุฏ
- email (VARCHAR)                    - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- hardware_id (VARCHAR)              - ูุนุฑู ุงูุฌูุงุฒ ุงููุฑูุฏ โญ
- subscription_type (VARCHAR)        - ููุน: trial/month/6_months/year/lifetime
- is_trial (BOOLEAN)                 - ูู ุงุณุชูุฎุฏูุช ุงูุชุฌุฑุจุฉ ูุณุจูุงู (ุฑุจุท ุจู hardware_id)
- subscription_code (VARCHAR)        - ุฑูุฒ ุงูุงุดุชุฑุงู
- activation_date (TIMESTAMP)        - ุชุงุฑูุฎ ุงูุชูุนูู
- expiry_date (TIMESTAMP)            - ุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ
- is_active (BOOLEAN)                - ูู ุงูุงุดุชุฑุงู ูุดุท ุงูุขู
- email_verified (BOOLEAN)           - ูู ุชู ุงูุชุญูู ูู ุงูุจุฑูุฏ ุนุจุฑ OTP
- otp_code (VARCHAR)                 - ููุฏ OTP ุงูุญุงูู
- otp_expiry (TIMESTAMP)             - ูุชู ููุชูู OTP
- device_transfer_count (INT)        - ุนุฏุฏ ูููุงุช ุงูุฌูุงุฒ (ุขุฎุฑ 30 ููู)
- last_device_transfer_date (TIMESTAMP) - ุขุฎุฑ ูููุฉ ุฌูุงุฒ
- last_check_date (TIMESTAMP)        - ุขุฎุฑ ุชุญูู ูู ุงูุฎุงุฏู
- created_at (TIMESTAMP)             - ูุชู ุชู ุงูุฅูุดุงุก
- updated_at (TIMESTAMP)             - ูุชู ุชู ุงูุชุญุฏูุซ ุงูุฃุฎูุฑ
```

#### 2๏ธโฃ `macro_fort_subscription_codes` (ุฃููุงุฏ ุงูุงุดุชุฑุงู) โญ Session 28
```sql
ุงูุญููู ุงูุฑุฆูุณูุฉ:
- id (UUID)                    - ูุนุฑู ูุฑูุฏ
- code (VARCHAR)               - ุงูููุฏ ุงููุฑูุฏ
- subscription_type (VARCHAR)  - ููุน ุงูุงุดุชุฑุงู
- status (VARCHAR)             - โญ FIXED: unused / used / expired ููุท (3 ุญุงูุงุช)
- email (VARCHAR)              - ุงูุจุฑูุฏ ุงููุฑุชุจุท (ุฅู ูุฌุฏ)
- hardware_id (VARCHAR)        - ุงูุฌูุงุฒ ุงููุฑุชุจุท (ุฅู ูุฌุฏ)
- used_date (TIMESTAMP)        - ูุชู ุชู ุงุณุชุฎุฏุงู ุงูุฑูุฒ
- expiry_date (TIMESTAMP)      - ูุชู ููุชูู ุงูุฑูุฒ
- duration_days (INT)          - ูุฏุฉ ุงูุงุดุชุฑุงู ุจุงูุฃูุงู
- created_at (TIMESTAMP)       - ูุชู ุชู ุงูุฅูุดุงุก
- updated_at (TIMESTAMP)       - ุขุฎุฑ ุชุญุฏูุซ

โญ CHECK Constraint (Session 28):
CHECK (status IN ('unused', 'used', 'expired'))
- โ ุชู ุฅุฒุงูุฉ 'active' (ูุงู ุฒุงุฆุฏ)
- โ 3 ุญุงูุงุช ููุท ุชููุฑ ููุทู ูุงุถุญ
```

#### 3๏ธโฃ `macro_fort_verification_codes` (OTP ู Rate Limiting) โญ ููู
```sql
ุงูุญููู ุงูุฑุฆูุณูุฉ:
- id (UUID)                    - ูุนุฑู ูุฑูุฏ
- email (VARCHAR)              - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ููุชุงุญ ุงูุจุญุซ)
- code (VARCHAR)               - ููุฏ OTP (6 ุฃุฑูุงู)
- is_used (BOOLEAN)            - ูู ุชู ุงุณุชุฎุฏุงู ุงูููุฏ
- created_at (TIMESTAMP)       - ูุชู ุชู ุงูุฅูุดุงุก
- expires_at (TIMESTAMP)       - ูุชู ููุชูู ุงูููุฏ (10 ุฏูุงุฆู)
- last_otp_sent_at (TIMESTAMP) - ุขุฎุฑ ุทูุจ OTP โญ (Rate Limiting)
- otp_request_count (INT)      - ุนุฏุฏ ุทูุจุงุช OTP ูู 10 ุฏูุงุฆู โญ
- is_throttled (BOOLEAN)       - ูู ููุฌุฏ ููู ุญุงููุงู โญ
- throttle_until (TIMESTAMP)   - ูุชู ููุชูู ุงูููู โญ (15 ุฏูููุฉ)
```

โญ **ุงูุญููู ุงูููููุฉ** = ูุณุชุฎุฏูุฉ ูู Rate Limiting (ุฌุฏูุฏ ูู Session 22)

---

## โ ุงูููุฒุงุช ุงููููุฐุฉ

### ๐ ุงููุตุงุฏูุฉ ูุงูุชุญูู
- โ ุงูุชุณุฌูู ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- โ OTP ุนุจุฑ ุงูุจุฑูุฏ (6 ุฃุฑูุงู)
- โ ุชุญุฏูุฏ ูุนุฏู ุงูุทูุจุงุช: 5 ูุญุงููุงุช ููู 10 ุฏูุงุฆู
- โ ููู ููุฏุฉ 15 ุฏูููุฉ ุนูุฏ ุชุฌุงูุฒ ุงูุญุฏ
- โ ุตูุงุญูุฉ OTP: 10 ุฏูุงุฆู
- โ ููุน ุงูุณุจุงู (ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช - Session 22)

### ๐ณ ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงูุงุช โญ Session 28
- โ ุฃููุงุน ุงุดุชุฑุงูุงุช: trial (7 ุฃูุงู), month, 6_months, year, lifetime
- โ ุชุฑููุฉ ูู ุงูุชุฌุฑุจุฉ ุฅูู ุงูุฏูุน
- โ ุฏุนู ุฃููุงุฏ ุงูุงุดุชุฑุงู ูุน **3 ุญุงูุงุช ูุญุฏุฏุฉ** (unused/used/expired)
- โ ูุญุต ุงูุชูุงุก ุงูุตูุงุญูุฉ (ุชุญุฏูุซ ุชููุงุฆู ููุญุงูุฉ)
- โ ููู ุงูุฌูุงุฒ (ุญุฏ ุฃูุตู 3 ูุฑุงุช/30 ููู)
- โ **Grace Period ูุญุณูู**: 5 ุฏูุงุฆู (ูู 30) - Session 28

### ๐ก๏ธ ุฃูุงู ุงูุชุฌุฑุจุฉ ุงููุฌุงููุฉ
- โ ูุฑุฉ ูุงุญุฏุฉ ููุท ููู ุฌูุงุฒ (ุฑุจุท ุจู hardware_id)
- โ ุญูู `is_trial` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงูุณุฌู ูุญูุธ ุฏุงุฆูุงู (ุญุชู ุจุนุฏ ุงูุชุฑููุฉ)
- โ ูุญุต ุนูุฏ ูู ูุญุงููุฉ ุชูุนูู

### ๐ฑ ุฃูุงู ูุนุฑู ุงูุฌูุงุฒ
- โ Hardware ID ูุฑูุฏ ููุณุชูุฑ
- โ ุชูููุฏ ูุฑุฉ ูุงุญุฏุฉ ููุท
- โ ุญูุธ ูุญูู ุนูู ุงูุฌูุงุฒ
- โ ุงุณุชุฎุฏุงู ูู ูู ุนูููุฉ ุชูุนูู

### ๐ซ ููุน ุงูุณุจุงู (Rate Limiting) โญ ุฌุฏูุฏ - Session 22
- โ **ููู ูู ูู ุงูุฐุงูุฑุฉ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
- โ ุจูุงูุงุช ูุญููุธุฉ ุฏุงุฆูุงู (ุชุณุชูุฑ ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู)
- โ ุชุนูู ุนุจุฑ ุนุฏุฉ ูุณุฎ ุงูุชุทุจูู (distributed)
- โ ุญูุงูุฉ ุถุฏ ุงููุฌูุงุช ุงูููุฒุนุฉ
- โ ุณุฌู ูุงูู ูุฌููุน ูุญุงููุงุช OTP

---

## ๐ ุขุฎุฑ ุงูุชุญุฏูุซุงุช

### Session 30 Portion 2 - Security Hardening & Railway-Only Architecture โญโญโญ (ุงูุฌุฏูุฏ - ุญุฑุฌ)
**ุงูุชุงุฑูุฎ**: 2025-12-21 | **ุงูุฃูููุฉ**: ๐ด ุญุฑุฌุฉ ุฌุฏุงู | **ุงูุญุงูุฉ**: โ ููุชููุฉ

#### ๐ ููุฎุต ุงูุฌูุณุฉ
ุงูุชุดุงู ูุงุณุชุฆุตุงู 4 ูููุงุช legacy ุชุญุชูู ุนูู ุจูุงูุงุช ุงุนุชูุงุฏ ููุดููุฉุ ูุชุญุฏูุซ ุฌููุน API calls ูุงุณุชุฎุฏุงู Railway Proxy ุจุฏูุงู ูู ุงูุงุชุตุงู ุงููุจุงุดุฑ ูุน Supabaseุ ุชุญููู ูุนูุงุฑูุฉ ุขููุฉ ูุญููุฉ ุจู 100%.

#### ๐ด ุงููุดุงูู ุงูููุชุดูุฉ ูุงููุญูููุฉ

**1. ุฃุฑุจุนุฉ ูููุงุช legacy ูุน ุจูุงูุงุช ุงุนุชูุงุฏ ููุดููุฉ (ุชู ุญุฐููุง):**
```
โ LicenseService.cs
   - Hardcoded: https://vogdhlbcgokhqywyhfbn.supabase.co
   - Hardcoded: JWT API Key (ููุดูู)
   - ุงุชุตุงู ูุจุงุดุฑ REST API Supabase

โ NewActivationService.cs
   - ููุณ Hardcoded URL
   - ServiceRoleKey ููุดูู ูู ุงูููุฏ
   - ุงุณุชุฎุฏุงู ูุจุงุดุฑ ูู /rest/v1/ endpoints

โ ActivationWindow.xaml.cs ู .xaml
   - UI ูุฏูู ูุณุชุฎุฏู LicenseService (ุฎุทูุฑ)

โ NewActivationWindow.xaml.cs ู .xaml
   - UI ูุฏูู ูุณุชุฎุฏู NewActivationService (ุฎุทูุฑ)

โ ุฌููุน ุงููููุงุช ุชู ุญุฐููุง ุจูุฌุงุญ
```

**2. MacroFortActivationService.cs (61+ locations ูุน ูุดุงูู ุฃูููุฉ):**
```
ุงูุณุงุจู (ุฎุทูุฑ ุฌุฏุงู):
- 61+ ุงุณุชุฏุนุงุก ูุจุงุดุฑ ูู Supabase /rest/v1/ endpoints
- ุงุณุชุฎุฏุงู _credentials.ServiceRoleKey ููุดูู
- _credentialsManager ูุญูุธ ุงูููุงุชูุญ ูุญููุงู

ุงูุญุงูู (ุขูู ุชูุงูุงู):
- ุฌููุน API calls ุนุจุฑ Railway Proxy ููุท
- RAILWAY_PROXY_URL = "https://sr3h-auth-proxy-production.up.railway.app"
- 12 ุฏุงูุฉ ูุญุฏุซุฉ ููุงุณุชุฎุฏุงู ุงูุขูู
```

#### โ ุงูุชุญุฏูุซุงุช ุงููุทุจูุฉ

**1. ุญุฐู ุงููููุงุช ุงูุฎุทุฑุฉ:**
```
- โ LicenseService.cs (ุญุฐู)
- โ NewActivationService.cs (ุญุฐู)
- โ ActivationWindow.xaml + .xaml.cs (ุญุฐู)
- โ NewActivationWindow.xaml + .xaml.cs (ุญุฐู)
```

**2. ุชุญุฏูุซ MacroFortActivationService.cs (61+ locations โ Railway Proxy):**

| ุงูุฏุงูุฉ | ุงูุณุงุจู | ุงูุญุงูู |
|--------|---------|---------|
| **CallTrialEligibilityCheckAsync()** | Supabase REST | Railway `/check-trial-eligibility` |
| **CallActivateTrialRpcAsync()** | Supabase REST | Railway `/activate-trial` |
| **VerifyTrialOtpAsync()** | Supabase REST | Railway `/check-trial-subscription-by-email` |
| **VerifyOtpInVerificationTableAsync()** | Supabase REST | Railway `/verify-otp` |
| **MarkVerificationOtpAsUsedAsync()** | Supabase REST | Railway `/mark-otp-used` |
| **MarkTrialOtpAsUsedAsync()** | Supabase REST | Railway `/check-trial-by-hardware` |
| **UpdateSubscriptionVerificationAsync()** | Supabase REST | Railway `/check-trial-by-email` (PATCH) |
| **InsertOtpCodeAsync()** | Supabase REST | Railway `/create-otp` |
| **SaveOtpViaProxyAsync()** | Supabase REST | Railway `/save-otp` |
| **GetLastOtpAsync()** | Supabase REST | Railway `/get-last-otp` |
| **UpdateSpamTrackingAsync()** | Supabase REST | Railway `/update-otp-tracking` |
| **LogHardwareVerificationAsync()** | Supabase REST | Railway `/log-hardware-verification` |

**3. ุฅุฒุงูุฉ ุงูุญููู ุงูุฎุทุฑุฉ:**
```csharp
// โ ุชู ุญุฐููุง:
private MacroFortSecureCredentialsManager _credentialsManager;
private MacroFortCredentials _credentials;
private void InitializeCredentials() { ... }

// โ ุงุณุชุจุฏุงููุง:
private const string RAILWAY_PROXY_URL = "https://sr3h-auth-proxy-production.up.railway.app";
```

**4. ุชุญุฏูุซ LicenseSettingsWindow.xaml.cs:**
```csharp
// ุงูุณุงุจู (ุฎุทูุฑ):
new ActivationWindow()

// ุงูุญุงูู (ุขูู):
new MacroFortActivationWindow(MacroFortActivationType.Rebind)
```

**5. ุชุญุฏูุซ .gitignore (ุดุงูู):**
```
# Security: Credentials & Keys
*.bin, *.key, *.pem, *.crt
.env*
credentials.json

# Configuration Files
appsettings.*.json
web.config
app.config

# Railway & Supabase
railway.json
supabase.json

# Build & Dependencies
bin/, obj/
node_modules/
dist/

# IDE Settings
.vscode/, .vs/
*.suo, *.user

# Logs
logs/
*.log

# Temporary Files
temp/
tmp/
```

#### ๐ ุงููุนูุงุฑูุฉ ุงูุขููุฉ ุงููุญููุฉ (Three-Tier Security)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                             โ
โ  TIER 1: LOCAL APPLICATION (WPF - C# .NET 9)              โ
โ  โ ูุง ุชูุฌุฏ ููุงุชูุญ                                         โ
โ  โ ูุง ุชูุฌุฏ ุจูุงูุงุช ุงุนุชูุงุฏ                                 โ
โ  โ ูุง ุงุชุตุงู ูุจุงุดุฑ ูุน Supabase                            โ
โ                                                             โ
โ         โ (Semantic HTTP Calls via HTTPS)                  โ
โ                                                             โ
โ  TIER 2: RAILWAY GATEWAY (Node.js Proxy)                  โ
โ  โ ุฌููุน ุงูููุงุชูุญ ูู Environment Variables ููุท            โ
โ  โ SUPABASE_SERVICE_ROLE_KEY ูุญููุธ ููุง ููุท              โ
โ  โ ุงูุชุญููู ุงูุขูู ูู REST API ุฅูู Supabase              โ
โ  ๐ URL: https://sr3h-auth-proxy-production.up.railway.appโ
โ  ๐ GitHub: https://github.com/anamsmmy/sr3h-auth-proxy    โ
โ                                                             โ
โ         โ (Internal Secure Connection)                     โ
โ                                                             โ
โ  TIER 3: SUPABASE DATABASE (PostgreSQL)                    โ
โ  โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุท (ูุง ููุทู)                         โ
โ  โ ูุง ุชูุจู ุงุชุตุงูุงุช ูุจุงุดุฑุฉ ูู ุงูุนููู                    โ
โ                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### ๐ ุงููุชุงุฆุฌ ูุงูุชุญูู

**Build Verification:**
```
โ Build Status: SUCCESS
โ Exit Code: 0
โ Compilation Errors: 0
โ๏ธ  Non-Critical Warnings: 51 (obsolete APIs, platform-specific)
โ Generated DLL: c:\SR3H_MACRO\bin\Debug\net9.0-windows\SR3H MACRO.dll
```

**Git Repository:**
```
โ Repository Initialized: git init
โ User Configured: security@sr3h-macro.dev
โ Files Staged: 260 files
โ Commit Successful: ba65963
โ Message: "Security update for Railway proxy architecture"
```

**Validation Against info.md Requirements:**
| ุงููุชุทูุจ | ุงูุญุงูุฉ | ุงูุชูุงุตูู |
|--------|--------|---------|
| **ูุง ููุงุชูุญ ูู Local App** | โ | ุฌููุน ุงููุฑุงุฌุน ูุญุฐููุฉ |
| **ูุง ุชุฎุฒูู ูุญูู ููุจูุงูุงุช ุงูุงุนุชูุงุฏูุฉ** | โ | ุญุฐู MacroFortSecureCredentialsManager |
| **ุฌููุน DB Access ุนุจุฑ Railway** | โ | 61+ calls ูุญุฏุซุฉ |
| **ServiceRoleKey ูู Railway ููุท** | โ | ูุง ููุฌุฏ ูู C# code |
| **Subscription Code Persistence** | โ | `/redeem-code` ูุนูู ุจุดูู ุฐุฑู |
| **.gitignore ุดุงูู** | โ | ุฌููุน ุงููููุงุช ุงูุญุณุงุณุฉ ูุณุชุซูุงุฉ |

#### ๐ ุงููููุงุช ุงููุนุฏูุฉ (Session 30 P2)

| ุงูููู | ุงูุญุงูุฉ | ุงูุณุจุจ |
|------|--------|-------|
| `MacroFortActivationService.cs` | โ ูุญุฏุซ | 61+ locations ุฅูู Railway |
| `LicenseSettingsWindow.xaml.cs` | โ ูุญุฏุซ | ุงุณุชุฎุฏุงู MacroFortActivationWindow |
| `.gitignore` | โ ุฌุฏูุฏ | ุฃูุงู ุดุงูู |
| `LicenseService.cs` | โ ูุญุฐูู | Hardcoded credentials |
| `NewActivationService.cs` | โ ูุญุฐูู | Hardcoded credentials |
| `ActivationWindow.xaml(.cs)` | โ ูุญุฐูู | Legacy + dangerous |
| `NewActivationWindow.xaml(.cs)` | โ ูุญุฐูู | Legacy + dangerous |

#### ๐ฏ ููุงุท ูููุฉ

**ูุง ุชูุฑุฌุน ุงููููุงุช ุงููุญุฐููุฉ:**
```
โ LicenseService.cs       - ุฎุทุฑ
โ NewActivationService.cs - ุฎุทุฑ
โ ActivationWindow.xaml   - ูุฏูู ูุฎุทุฑ
โ NewActivationWindow.xaml - ูุฏูู ูุฎุทุฑ
```

**ูุฑุงุฑ ุงูุชุทููุฑ ุงููุญูู:**
```
โ ุชุทููุฑ ูุญูู ููุท
โ git ูุญูู ูููุณุฎ ุงูุงุญุชูุงุทูุฉ
โ ุจุฏูู ูุดุฑ ุนูู GitHub
   (ุงูุณุจุจ: ุนููู ูุญูู ุจุฏูู ุชุดุงุฑูุ ูุงูู proxy ููุฌูุฏ ุจุงููุนู)
```

#### โ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ
```
๐ ุงููุนูุงุฑูุฉ: THREE-TIER SECURITY MODEL
โ ุงูุฃูุงู: 100% (ุฌููุน ุงููุชุทูุจุงุช ูุญููุฉ)
โ ุงูุงุณุชูุฑุงุฑ: Build ูุฌุญ (0 errors)
โ ุงูุงูุชุซุงู: railway-only architecture ููุฑูุถุฉ
โณ ุงูุฎุทูุฉ ุงูุชุงููุฉ: ุงูุชุทููุฑ ูุงูุงุฎุชุจุงุฑ ุงููุญูู ุงููุณุชูุฑ
```

---

### Session 28 - Grace Period + Subscription Code Status Verification โญ
**ุงูุชุงุฑูุฎ**: 2025-12-20 | **ุงูุฃูููุฉ**: ๐ ุนุงููุฉ

#### ุงูุชุญุฏูุซุงุช ุงููุทุจูุฉ

##### 1๏ธโฃ Grace Period Optimization (ุชูููู ุงููุฏุฉ)
ุชู ุชูููู ูุชุฑุฉ ุงูุณูุงุญ (grace period) ูู **30 ุฏูููุฉ** ุฅูู **5 ุฏูุงุฆู** ุนุจุฑ:

**ุงููููุงุช ุงููุนุฏูุฉ:**
- โ `SessionActivationCache.cs:18` - ุชุบููุฑ `GRACE_PERIOD_MINUTES` ูู 30 โ 5
- โ `MacroFortActivationService.cs:150` - ุชุญุฏูุซ `SetGracePeriodExpiry(DateTime.UtcNow.AddMinutes(5))`
- โ `BackgroundValidationScheduler.cs:109` - ุชุญุฏูุซ `SetGracePeriodExpiry(DateTime.UtcNow.AddMinutes(5))`

**ุงูุฃุซุฑ ุงูุฃููู:**
- โฑ๏ธ ุชูููู ูุงูุฐุฉ ุงูุงุฎุชุฑุงู ูู 30 ุฏูููุฉ ุฅูู 5 ุฏูุงุฆู ููุท
- โฑ๏ธ ููุฑุถ ุฅุนุงุฏุฉ ุชุญูู ุฃุณุฑุน ูู ุงูุฎุงุฏู
- โฑ๏ธ ุญูุงูุฉ ุฃููู ุถุฏ ุงูุฃุฌูุฒุฉ ุงููุณุฑููุฉ

---

##### 2๏ธโฃ Subscription Code Status Field - Verification & Enforcement
ุชู ุงูุชุญูู ูู ูุฌูุฏ ุญูู `status` ูู ุฌุฏูู `macro_fort_subscription_codes` ูุชุฃููุฏ ุฃูู ูุนูู ุจู **3 ุญุงูุงุช ููุท**:

**ุงูุญูู:**
```sql
status VARCHAR(20) DEFAULT 'unused'
CHECK (status IN ('unused', 'used', 'expired'))
```

**ุงูุญุงูุงุช ุงูุซูุงุซ:**
| ุงูุญุงูุฉ | ุงููุตู | ุงูุงูุชูุงู |
|--------|-------|---------|
| **unused** (ุบูุฑ ูุณุชุฎุฏู) | ุฑูุฒ ุฌุฏูุฏ ูู ููุณุชุฎุฏู | ุนูุฏ ุงูุฅูุดุงุก |
| **used** (ูุณุชุฎุฏู) | ุฑูุฒ ุชู ุงุณุชููุงูู ุจูุฌุงุญ | ุนูุฏ ุงุณุชุฏุนุงุก `redeem_subscription_code()` |
| **expired** (ููุชูู) | ุฑูุฒ ุชุฌุงูุฒ ุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ | ุชููุงุฆู ุนูุฏ ูุญุต ุงูุชุงุฑูุฎ |

**ุงููููุงุช ุงููุญุฏุซุฉ:**
- โ `migration_add_subscription_code_status.sql` - ุชุญุฏูุซ CHECK constraint ูุฅุฒุงูุฉ 'active'
- โ `migration_update_code_status_functions.sql` - ุชุญุฏูุซ ููุทู ุงูุฏูุงู
- โ `migration_fix_subscription_code_status.sql` - NEW: ููู ุดุงูู ููุชุทุจูู

**ุงูุฏูุงู ุงูุฃุฑุจุน ุงููุญุฏุซุฉ:**

1. **`validate_subscription_code_status(p_code TEXT)`**
   ```
   - ูุชุญูู ูู ุญุงูุฉ ุงูุฑูุฒ (unused/used/expired)
   - ูุนููู ุงูุญุงูุฉ ุชููุงุฆูุงู ุฅูู 'expired' ุฅุฐุง ุงูุชูุช ุงูุตูุงุญูุฉ
   - ูุฑุฌุน JSON ูุชุถูู valid + status + ุฑุณุงูุฉ ุจุงูุนุฑุจูุฉ
   ```

2. **`redeem_subscription_code(p_code, p_email, p_hardware_id)`**
   ```
   - ููุญุต ุงูุฑูุฒ: ูุฌุจ ุฃู ูููู status='unused' ูุบูุฑ ููุชูู ุงูุตูุงุญูุฉ
   - ุนูุฏ ุงููุฌุงุญ: ููุดุฆ ุงุดุชุฑุงู + ูุญุฏุซ status ุฅูู 'used'
   - ูุญูุธ hardware_id ุชููุงุฆูุงู (ุฅุตูุงุญ ุงูุฎุทุฃ ุงูุณุงุจู)
   ```

3. **`authenticate_user(p_email, p_subscription_code)`**
   ```
   - ููุญุต status='unused' ููุท
   - ูุณุชุฑุฌุน ุงูุฑูุฒ ุจูุฌุงุญ
   - ูุญุฏุซ ุงูุญุงูุฉ ุฅูู 'used'
   ```

4. **`mark_code_as_used(p_code, p_email)`**
   ```
   - ุชุญุฏูุซ ูุฏูู ููุญุงูุฉ ูู 'unused' ุฅูู 'used'
   - ููุดู ุฅุฐุง ูุงู ุงูุฑูุฒ ุจุญุงูุฉ ุฃุฎุฑู
   ```

**ุงูุงุฎุชุจุงุฑุงุช ุงูุชู ุชูุช:**
```
โ Constraint Check: ุชู ุงูุชุญูู ูู ุงูููู ุงููุณููุญุฉ
โ Unused Code: validate_subscription_code_status() โ valid=true
โ Redeem Code: redeem_subscription_code() โ status='used' + expiry_date ูุญุฏุซุฉ
โ Expired Code: ุชู ุชุนููู expiry_date ูู ุงููุงุถู โ status='expired'
โ Database Lookup: ุชู ุงูุชุญูู ูู ุชุญุฏูุซ ุงูุญุงูุฉ ุจุดูู ุตุญูุญ
```

**ุงููุชุงุฆุฌ:**
```json
// Unused State
{
  "valid": true,
  "status": "unused",
  "message": "ุงูุฑูุฒ ูุชุงุญ ููุงุณุชุฎุฏุงู"
}

// After Redemption
{
  "code": "MONTH-K7NM2P-X9QR4V-L8T1S5",
  "status": "used",
  "used_date": "2025-12-20T23:26:31"
}

// Expired State
{
  "valid": false,
  "status": "expired",
  "message": "ุงูุชูุช ุตูุงุญูุฉ ุงูุฑูุฒ"
}
```

---

##### 3๏ธโฃ RPC Functions - Cleanup ูู ุงูุฃุนูุฏุฉ ุงููุชุฑููุฉ
ุชู ุชูุธูู ุฌููุน ุงูุฅุดุงุฑุงุช ุฅูู ุงูุฃุนูุฏุฉ ุงููุญุฐููุฉ ุณุงุจูุงู:
- โ ุฃุฒููุช ุฌููุน ูุญุงููุงุช ุงูุฅุดุงุฑุฉ ุฅูู `subscription_code` ูู PATCH/INSERT
- โ ุงูุฏูุงู ุงูุขู ุชุณุชุฎุฏู `status` ุจุฏูุงู ูู ูุญุต ุงูุญููู ุงููุฏููุฉ

---

#### ุงููููุงุช ุงูุฌุฏูุฏุฉ ุงููููุดุฃุฉ (Session 28)
1. **`migration_fix_subscription_code_status.sql`** - Migration ุดุงูู (328 ุณุทุฑ)
   - ูุญุฏุซ ุงูู CHECK constraint
   - ูุญุฏุซ 4 ุฏูุงู RPC
   - ูููุญ ุงูุฃุฐููุงุช ุงูุตุญูุญุฉ
   - ูุณุฌู ุงูู migration ูู ุงูู tracking table

2. **`apply_subscription_code_status_fix.js`** - Script ููุชูููุฐ
3. **`apply_subscription_code_status_fix_v2.js`** - ูุณุฎุฉ ูุญุณููุฉ
4. **`SUBSCRIPTION_CODE_STATUS_FIX_GUIDE.md`** - ุฏููู ุงูุชุทุจูู ูุงูุชุญูู

---

#### ุฃุซุฑ ุงูุชุบููุฑุงุช (Session 28)
| ุงูุฌุงูุจ | ุงูุชุฃุซูุฑ |
|--------|--------|
| **ุงูุฃูุงู** | โ ุชูููู grace period ร 6 (ูู 30 ุฅูู 5 ุฏูุงุฆู) |
| **ุงูุงุณุชูุฑุงุฑ** | โ ุฅุฒุงูุฉ ุงูุญุงูุฉ 'active' ุงูุฒุงุฆุฏุฉ (3 ุญุงูุงุช ููุท) |
| **ุงููุถูุญ** | โ ููุทู ูุงุถุญ ุฌุฏุงู (unusedโusedโexpired) |
| **ุงูุงุฎุชุจุงุฑ** | โ ุงุฎุชูุจุฑุช ุฌููุน ุงูุญุงูุงุช ุงูุซูุงุซ ุจูุฌุงุญ |
| **ุงูุฃุฏุงุก** | โ ุจุฏูู ุชุฃุซูุฑ (ุงุณุชุนูุงูุงุช ูุญุณููุฉ) |
| **ุงูุงูุชุซุงู** | โ CHECK constraint ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช |

---

#### ููุงุท ูููุฉ ูุง ุชูุนุงุฏ ููุงูุดุชูุง
- โ **ูุง ุชูุถู ุญุงูุฉ 'active' ูุฌุฏุฏุงู** - ุงูุซูุงุซ ุญุงูุงุช ูุงููุฉ ุชูุงูุงู
- โ **ูุง ุชุฒุฏ grace period ุนู 5 ุฏูุงุฆู** - ุชูููู ูู 30 ูุงู ูุฑุงุฑ ุฃููู
- โ **ุญุงูุงุช ุงูุฑูุฒ ููุณุช ูุงุจูุฉ ููุชุนุฏูู** - ูู ุฏูู ูุญุฏุฏุฉ ููุท ูู DB schema
- โ **ููุทู ุงูุญุงูุฉ ูุญุฏูุฏ ููุงุถุญ** - unused โ used (ุนูุฏ ุงูุงุณุชููุงู) ุฃู expired (ููุช ุชููุงุฆู)

---

### Session 22 - Database-Backed Rate Limiting โญ
**ุงูุชุงุฑูุฎ**: 2025-12-19 | **ุงูุฃูููุฉ**: ๐ด ุญุฑุฌุฉ

#### ุงููุดููุฉ ุงูููุชุดูุฉ
ูุงู ููุน ุงูุณุจุงู ููุฎุฒูู ูู ุฐุงูุฑุฉ ุงูุชุทุจูู ููุท:
- โ **ููุฏุงู ุงูุจูุงูุงุช ุนูุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู**: ุงููุณุชุฎุฏููู ูููููู ุงูุชุญุงูู ุจุฅุนุงุฏุฉ ูุชุญ ุงูุชุทุจูู
- โ **ุจุฏูู ุญูุงูุฉ ููุฒุนุฉ**: ูุง ุชูุฌุฏ ุญูุงูุฉ ุนูุฏ ุชุดุบูู ุนุฏุฉ ูุณุฎ
- โ **ูุง ุณุฌู ุฏุงุฆู**: ูุง ูููู ุชุฏููู ุฃู ุชุญููู ูุญุงููุงุช OTP
- โ **ุนุฑุถุฉ ูููุฌูุงุช ุงูููุณูุฉ**: ููุงุฌู ููููู ุงุณุชุฎุฏุงู ุนุฏุฉ ุฃุฌูุฒุฉ

#### ุงูุญู ุงููุทุจู
ููู ููุน ุงูุณุจุงู ูู `Dictionary` ูู ุงูุฐุงูุฑุฉ ุฅูู ุฌุฏูู `macro_fort_verification_codes`:

```csharp
// ุงูุณุงุจู (ุฎุงุทุฆ):
private Dictionary<string, int> _otpRequestCounts;           // โ ููููุฏ ุนูุฏ ุงูุฅุนุงุฏุฉ
private Dictionary<string, DateTime> _lastOtpRequestTime;    // โ ุจุฏูู ุชูุฒูุน
private Dictionary<string, DateTime> _throttleUntilTime;     // โ ุจุฏูู ุชุฏููู

// ุงูุญุงูู (ุตุญูุญ):
// ุฌููุน ุงูุจูุงูุงุช ูู: macro_fort_verification_codes
// ุงูุญููู: last_otp_sent_at, otp_request_count, is_throttled, throttle_until
```

#### ุงูุทุฑู ุงูุฌุฏูุฏุฉ ูู MacroFortActivationService.cs

**1. `CheckOtpSpamStatusAsync(email: string)`**
```csharp
// ูุญุต ุญุงูุฉ ุงูุณุจุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
// ูุฑุฌุน: (canProceed, message, remainingMinutes)

ูุซุงู ุงูุงุณุชุฎุฏุงู:
var (canProceed, message, remainingMinutes) = await CheckOtpSpamStatusAsync(email);
if (!canProceed) {
    return new Result { Message = message };  // ุฑูุน ุทูุจ OTP
}
```

**2. `RecordOtpRequestAsync(email: string)`**
```csharp
// ุชุณุฌูู ุทูุจ OTP ุฌุฏูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
// ูุฒูุฏ otp_request_count ุจู 1
// ูุญุฏูุซ last_otp_sent_at ุจุงูููุช ุงูุญุงูู

ูุชู ุงุณุชุฏุนุงุคูุง ุจุนุฏ ุฅุฑุณุงู OTP ุจูุฌุงุญ
```

**3. `UpdateSpamTrackingAsync(email, lastOtpSentAt, otpRequestCount, throttleUntil)`**
```csharp
// ุชุญุฏูุซ ุณุฌู ุงูุณุจุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
// ูุฏุนู ุชุญุฏูุซ ุฃู ุญูู (ุงุฎุชูุงุฑู):
// - last_otp_sent_at: ููุช ุขุฎุฑ ุทูุจ
// - otp_request_count: ุนุฏุฏ ุงูุทูุจุงุช
// - throttle_until: ูุชู ููุชูู ุงูููู

ูุชู ุงุณุชุฏุนุงุคูุง ูู CheckOtpSpamStatusAsync ุนูุฏ ุชุฌุงูุฒ ุงูุญุฏ
```

#### ุงููููุงุช ุงููุนุฏูุฉ (Session 22)

1. **MacroFortActivationService.cs**
   - โ ุญุฐู: `_otpRequestCounts`, `_lastOtpRequestTime`, `_throttleUntilTime`
   - โ ุฅุถุงูุฉ: `CheckOtpSpamStatusAsync()`
   - โ ุฅุถุงูุฉ: `RecordOtpRequestAsync()`
   - โ ุฅุถุงูุฉ: `UpdateSpamTrackingAsync()`
   - โ ุชุญุฏูุซ: `StartTrialAsync()` (ุงุณุชุฎุฏุงู DB ุจุฏู Memory)
   - โ ุชุญุฏูุซ: `SendOtpForCodeActivationAsync()` (ุงุณุชุฎุฏุงู DB ุจุฏู Memory)

#### ุงูููุงุฆุฏ ุงูุฃูููุฉ (Session 22)
| ุงูููุฒุฉ | ุงูุณุงุจู | ุงูุญุงูู |
|--------|---------|---------|
| **ุงุณุชูุฑุงุฑูุฉ ุงูุจูุงูุงุช** | โ ุชูููุฏ ุนูุฏ ุงูุฅุนุงุฏุฉ | โ ูุญููุธุฉ ุฏุงุฆูุงู ูู DB |
| **ุงูุญูุงูุฉ ุงูููุฒุนุฉ** | โ ูุง ุชูุฌุฏ | โ ุชุนูู ุนุจุฑ ุฌููุน ุงููุณุฎ |
| **ุงูุชุฏููู ูุงูุณุฌูุงุช** | โ ุจุฏูู ุณุฌู | โ ูุงูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช |
| **ุงููุฌูุงุช ุงูููุฒุนุฉ** | โ๏ธ ุนุฑุถุฉ ูููุฌูู | โ ูุญููุฉ 100% |
| **ุงูุฃุฏุงุก** | โ ุณุฑูุน ุฌุฏุงู | โ ุณุฑูุน (ุงุณุชุนูุงู ูุงุญุฏ ููุท) |

---

### Session 16 - Hardware ID-Based Trial Security
**ุงูุชุงุฑูุฎ**: 2025-12-13

#### ุงูุญู ุงููุทุจู
ุฑุจุท ุงูุชุฌุฑุจุฉ ุจู `hardware_id` ุจุฏูุงู ูู `email`:
- โ ุงูุชุญูู ูู ุงูุชุฌุฑุจุฉ ุจูุงุกู ุนูู ูุนุฑู ุงูุฌูุงุฒ ุงููุฑูุฏ
- โ ุงูุณุฌู ููุญูุธ ุฏุงุฆูุงู (ุญุชู ุจุนุฏ ุงูุชุฑููุฉ ูู trial ุฅูู ุฏูุน)
- โ ูุฑุฉ ูุงุญุฏุฉ ููุท ููู ุฌูุงุฒ (ูุญูู ุนุจุฑ ุฅุนุงุฏุฉ ุงูุชุซุจูุช)

---

## ๐ ุงููููุงุช ุงูุฑุฆูุณูุฉ

### ๐ Services
```
Services/
โโโ MacroFortActivationService.cs โญ ุงูููู ุงูุฑุฆูุณู
โ   โโโ StartTrialAsync()                      - ุจุฏุก ุงูุชุฌุฑุจุฉ ุงููุฌุงููุฉ
โ   โโโ SendOtpForCodeActivationAsync()        - ุฅุฑุณุงู OTP ูู activation code
โ   โโโ ConfirmCodeActivationAsync()           - ุชุฃููุฏ ุงูููุฏ ูุน OTP
โ   โโโ GetSubscriptionStatusAsync()           - ุฌูุจ ุญุงูุฉ ุงูุงุดุชุฑุงู ุงูุญุงููุฉ
โ   โโโ CheckTrialStatusAsync()                - ูุญุต ูุง ุฅุฐุง ุงุณุชูุฎุฏูุช ุงูุชุฌุฑุจุฉ (ุจู hardware_id)
โ   โโโ VerifyOtpAsync()                       - ุงูุชุญูู ูู ุตุญุฉ OTP
โ   โโโ โ CheckOtpSpamStatusAsync()           - ูุญุต ุญุงูุฉ ุงูุณุจุงู ูู DB (ุฌุฏูุฏ)
โ   โโโ โ RecordOtpRequestAsync()             - ุชุณุฌูู ุทูุจ OTP (ุฌุฏูุฏ)
โ   โโโ โ UpdateSpamTrackingAsync()           - ุชุญุฏูุซ ุณุฌู ุงูุณุจุงู (ุฌุฏูุฏ)
โ   โโโ GetSubscriptionByHardwareIdAsync()     - ุฌูุจ ุงุดุชุฑุงู ุจู hardware_id
โ   โโโ InsertTrialSubscriptionAsync()         - ุฅูุดุงุก ุชุฌุฑุจุฉ ูุฌุงููุฉ ุฌุฏูุฏุฉ
โ   โโโ UpdateTrialSubscriptionAsync()         - ุชุญุฏูุซ ุจูุงูุงุช ุงูุชุฌุฑุจุฉ
โ   โโโ [ุทุฑู ุฅุถุงููุฉ...]
โ
โโโ SubscriptionCodeService.cs
โ   โโโ GetCodeDetailsAsync()
โ   โโโ BindCodeToEmailAndDeviceAsync()
โ   โโโ MarkCodeAsUsedAsync()
โ   โโโ [ุทุฑู ุฃุฎุฑู...]
โ
โโโ EmailService.cs
โ   โโโ SendVerificationCodeAsync() - ุฅุฑุณุงู ุจุฑูุฏ OTP via Zoho
โ
โโโ SafeHardwareIdService.cs
โ   โโโ GenerateHardwareId() - ุชูููุฏ ูุนุฑู ุฌูุงุฒ ูุฑูุฏ ููุณุชูุฑ
โ
โโโ [ุฎุฏูุงุช ุฃุฎุฑู...]
```

### ๐ Models
```
Models/
โโโ MacroFortModels.cs
โ   โโโ MacroFortSubscription         - ูููุฐุฌ ุงูุงุดุชุฑุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
โ   โโโ MacroFortVerificationCode     - ูููุฐุฌ OTP ูุงูุณุจุงู
โ   โโโ MacroFortActivationResult     - ูุชูุฌุฉ ุนูููุฉ ุงูุชูุนูู
โ   โโโ MacroFortSubscriptionData     - ุจูุงูุงุช ุงูุงุดุชุฑุงู (ูุญุชูู IsTrial)
โ
โโโ [ููุงุฐุฌ ุฃุฎุฑู...]
```

---

## ๐ ุฃูุงูุฑ ุงูุจูุงุก ูุงูุงุฎุชุจุงุฑ

### ุงูุจูุงุก ุงูุฃุณุงุณู
```bash
cd C:\SR3H_MACRO
dotnet build MACRO_SR3H.sln
```

### ุงูุจูุงุก ูุน ุงููุถุน Debug
```bash
dotnet build MACRO_SR3H.sln -c Debug
```

### ุงูุชูุธูู ุงููุงูู
```bash
dotnet clean MACRO_SR3H.sln
dotnet build MACRO_SR3H.sln
```

### ุงูุชุญูู ูู ุงูุฃุฎุทุงุก
```bash
dotnet build --no-incremental
```

### ุงูุงุฎุชุจุงุฑุงุช (ุฅู ูุฌุฏุช)
```bash
dotnet test
```

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ (Priority Order)

### ๐ด ุฐุงุช ุงูุฃููููุฉ ุงูุนุงููุฉ (Session 28+)

#### โ ููุชููุฉ ูู Session 28
- [x] **Subscription Code Status Verification** - ุงุฎุชูุจุฑุช ุฌููุน ุงูุญุงูุงุช ุงูุซูุงุซ
  - [x] `unused` - ุฑูุฒ ุฌุฏูุฏ ุฌุงูุฒ ููุงุณุชุฎุฏุงู
  - [x] `used` - ุจุนุฏ ุงุณุชุฏุนุงุก redeem_subscription_code()
  - [x] `expired` - ุนูุฏ ุงูุชูุงุก ุงูุตูุงุญูุฉ ุชููุงุฆูุงู
  - [x] CHECK constraint ูุทุจู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  
- [x] **Grace Period Optimization** - ุชู ุชููููู ูู 30 ุฅูู 5 ุฏูุงุฆู
  - [x] SessionActivationCache.cs ูุญุฏุซ
  - [x] MacroFortActivationService.cs ูุญุฏุซ
  - [x] BackgroundValidationScheduler.cs ูุญุฏุซ
  - [x] Build ูุฌุญ (0 errors)

#### โณ ููุฏ ุงูุงูุชุธุงุฑ ููุฌูุณุงุช ุงููุงุฏูุฉ
- [ ] **ุงุฎุชุจุงุฑ ุดุงูู ูู Grace Period ุงูุฌุฏูุฏ (5 ุฏูุงุฆู)**:
  - [ ] ูุตู ุงูุฅูุชุฑูุช ุจุนุฏ ุงูุชูุนูู
  - [ ] ุงูุชุธุงุฑ 5 ุฏูุงุฆู (ูุฌุจ ุฃู ููุชูู ุงูููู)
  - [ ] ุงูุชุญูู ูู ุฅุนุงุฏุฉ ุงูุชุญูู ูู ุงูุฎุงุฏู
  
- [ ] ุงุฎุชุจุงุฑ ุงูููู ุนุจุฑ ุงูุฃุฌูุฒุฉ ุงููุฎุชููุฉ:
  - [ ] ุชูุนูู ุนูู ุฌูุงุฒ A
  - [ ] ููู ุงูููุฏ ูุฌูุงุฒ B (ูุฌุจ ุฃู ูุนูู)
  - [ ] ุงูุชุญูู ูู device_transfer_count

- [ ] ุงุฎุชุจุงุฑ ุณููุงุฑูู ุงูุชุฌุฑุจุฉ ุงููุฌุงููุฉ:
  - [ ] ุชูุนูู ุชุฌุฑุจุฉ ุนูู ุฌูุงุฒ
  - [ ] ูุญุงููุฉ ุชูุนูู ุชุฌุฑุจุฉ ุซุงููุฉ (ูุฌุจ ุฃู ููุฑูุถ)
  - [ ] ุญุฐู ุงูุชุทุจูู ูุฅุนุงุฏุฉ ุชุซุจูุชู (ูุฌุจ ุฃู ููุฑูุถ ุฃูุถุงู)

### ๐ก ุฃููููุฉ ูุชูุณุทุฉ
- [ ] ุชุญุณููุงุช ุงูุฃุฏุงุก:
  - [ ] ุชุฎุฒูู ูุคูุช (caching) ูุญุงูุฉ ุงูุงุดุชุฑุงู
  - [ ] ุชูููู ุนุฏุฏ ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
  - [ ] ูุนุงูุฌุฉ ุงูููุงู ุบูุฑ ุงููุชุฒุงููุฉ ุจููุงุกุฉ

- [ ] ุชุญุณููุงุช ุงูุฃูุงู:
  - [ ] ุชุดููุฑ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ ุนูู ุงูุฌูุงุฒ ุงููุญูู
  - [ ] ุฅุถุงูุฉ ุชูููุน ุฑููู ููุทูุจุงุช
  - [ ] ูุญุต ุณูุงูุฉ ุงูุจูุงูุงุช (integrity checks)

### ๐ข ูููุณุชูุจู ุงูุจุนูุฏ
- [ ] ููุญุฉ ุชุญูู ุงูุฅุฏุงุฑุฉ (Admin Dashboard)
- [ ] ูุธุงู ุงููุงุชูุฑุงุช ูุงูุฏูุน
- [ ] ุชูุงุฑูุฑ ุงูุงุณุชุฎุฏุงู ูุงูุชุญูููุงุช
- [ ] ูุธุงู ุงููุฑุงูุจุฉ ูุงูุฅูุฐุงุฑุงุช (Monitoring)
- [ ] ุฏุนู ุงููุชุนุฏุฏุฉ ุงููุบุงุช (Localization)

---

## โ๏ธ ููุงุญุธุงุช ุชูููุฉ ูููุฉ

### ๐ ูุนุงููุฑ ุงูููุช ูุงูุชุงุฑูุฎ
- โ **ุฌููุน ุงูุฃููุงุช ุจุตูุบุฉ UTC**
- โ ุงุณุชุฎุฏู `DateTime.UtcNow` ููุท
- โ ูุง ุชุณุชุฎุฏู `DateTime.Now` (ูุญูู = ุฎุทุฃ)

### ๐พ ูุนุฑู ุงูุฌูุงุฒ (Hardware ID)
- ุชูููุฏ ูุฑุฉ ูุงุญุฏุฉ ููุท ุนูุฏ ุฃูู ุชุดุบูู
- ุชุฎุฒูู ูุญูู ุนูู ุงูุฌูุงุฒ (`SafeHardwareIdService`)
- ุงุณุชุฎุฏุงู ูู ูู ุนูููุฉ OTP ู ุงุดุชุฑุงู
- **ูุง ูุชุบูุฑ** ุญุชู ุจุนุฏ ุฅุนุงุฏุฉ ุชุซุจูุช ุงูุชุทุจูู

### ๐ ููุฏ ุงูุชุญูู (OTP) ู Grace Period
| ุงููุนูุงุฑ | ุงููููุฉ | ุงูุชุญุฏูุซ |
|---------|---------|---------|
| ุตูุบุฉ OTP | 6 ุฃุฑูุงู ุนุดูุงุฆูุฉ | - |
| ุตูุงุญูุฉ OTP | 10 ุฏูุงุฆู | - |
| ุญุฏ ุงูุทูุจุงุช | 5 ูุญุงููุงุช ููู 10 ุฏูุงุฆู | - |
| ูุชุฑุฉ ุงูุงูุชุธุงุฑ | 60 ุซุงููุฉ ุจูู ุงูุทูุจุงุช | - |
| ูุฏุฉ ุงูููู | 15 ุฏูููุฉ | - |
| **ุงูุชุฎุฒูู** | **ูุงุนุฏุฉ ุงูุจูุงูุงุช** | Session 22 |
| **Grace Period** | **5 ุฏูุงุฆู** | โฌ๏ธ ูู 30 (Session 28) |

### ๐ ุฏูุฑุฉ ุญูุงุฉ ุงูุงุดุชุฑุงู
```
1. ุทูุจ ุงูุชุฌุฑุจุฉ
   โโโ CheckTrialStatusAsync() (ููุญุต hardware_id)
       โโโ ุฅู ูู ุชูุณุชุฎุฏู: ุฃุฑุณู OTP
       โโโ ุฅู ุงุณุชูุฎุฏูุช: ุฑูุถ

2. ุงูุชุญูู ูู OTP
   โโโ VerifyOtpAsync()
       โโโ ูุถุน is_trial=true + hardware_id

3. ููู ุงูุฌูุงุฒ (ููุณ ุงูููุฏ)
   โโโ BindCodeToEmailAndDeviceAsync()
       โโโ ูุนุฏูู hardware_id ุงูุฌุฏูุฏ
       โโโ device_transfer_count++

4. ุชุฑููุฉ ูู ุชุฌุฑุจุฉ ุฅูู ุฏูุน
   โโโ ConfirmCodeActivationAsync()
       โโโ UPDATE (ุจุฏู INSERT)
       โโโ ูุญุงูุธ ุนูู is_trial=true (ุณุฌู ุฏุงุฆู)
```

### ๐ก๏ธ ูุนุงููุฑ ุงูุฃูุงู
- โ **Parameterized Queries**: ุญูุงูุฉ ูู SQL Injection
- โ **HTTPS ููุท**: ุฌููุน ุงูุงุชุตุงูุงุช ูุดูุฑุฉ
- โ **API Key ูู ุงูุจูุฆุฉ**: ูุง ุชูุฌุฏ ููุงุชูุญ ููุดููุฉ
- โ **Rate Limiting ูู DB**: ุญูุงูุฉ ุถุฏ Brute Force
- โ **Hardware ID ุซุงุจุช**: ูููุน ุงูุงุญุชูุงู
- โ **OTP ูุญุฏูุฏ ุงููุฏุฉ**: 10 ุฏูุงุฆู ููุท

---

## ๐ ููุฎุต ุงูุญุงูุฉ ุงูุญุงููุฉ

```
โ ุงูููุชูู ูุงููุณุชูุฑ:
  โ ูุธุงู ุงูุชูุนูู ุงูุฃุณุงุณู (OTP ุนุจุฑ ุงูุจุฑูุฏ)
  โ ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงูุงุช (CRUD ูุงูู)
  โ ุงูุชุญูู ูู ุตูุงุญูุฉ ุงูุงุดุชุฑุงู
  โ ุฃูุงู ุงูุชุฌุฑุจุฉ ุงููุฌุงููุฉ (hardware_id-based)
  โ ุญูุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช (SQL Injection, Parameterized)
  โ ููู ุงูุฌูุงุฒ ูุน ุญุฏูุฏ ูุนููุฉ
  โ ููุน ุงูุณุจุงู ุงููุฏุนูู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช โญ (Session 22)
  โ Subscription Code Status Field (3 ุญุงูุงุช: unused/used/expired) โญ (Session 28)
  โ Grace Period ูุญุณูู (5 ุฏูุงุฆู ูู 30) โญ (Session 28)
  โ ๐ ูุนูุงุฑูุฉ ุซูุงุซูุฉ ุขููุฉ (Three-Tier Security) โญ (Session 30 P2)
  โ ๐ ุงุณุชุฆุตุงู ุฌููุน ุจูุงูุงุช ุงูุงุนุชูุงุฏ ุงูููุดููุฉ โญ (Session 30 P2)
  โ ๐ Railway-Only Architecture ููุฑูุถุฉ โญ (Session 30 P2)
  โ ๐ git ูุญูู ูููุณุฎ ุงูุงุญุชูุงุทูุฉ โญ (Session 30 P2)

โณ ููุฏ ุงูุนูู:
  โ ุงุฎุชุจุงุฑ ุงูุชูุงูู ุงููุงูู ุจุนุฏ ุงูุฃูุงู ุงูุญุฏูุซ
  โ ุงุฎุชุจุงุฑ ุณููุงุฑูููุงุช ุงููุณุชุฎุฏู ุงูุญููููุฉ

๐ฎ ุงููุณุชูุจู:
  โข ููุญุฉ ุชุญูู ุงูุฅุฏุงุฑุฉ
  โข ูุธุงู ุงูุชุญูููุงุช ูุงูุชูุงุฑูุฑ
  โข ูุธุงู ุงูุฅูุฐุงุฑุงุช (Monitoring)
  โข ุชุญุณููุงุช ุงูุฃุฏุงุก (Caching)
```

---

## ๐ ุฃูุงู ุงููุนูููุงุช (Session 30 P2 - ููุญุฏูุซ)

### โ๏ธ ุชูุจูู ุฃููู ุญุฑุฌ - ูุนูุงุฑูุฉ ุงูุฃูุงู ุงูุญุงููุฉ

**ุงูุจููุฉ ุงูุขููุฉ ุงูููุฑูุถุฉ (Three-Tier):**
```
โ ุงูุชุทุจูู ุงููุญูู (WPF):
   - ุจุฏูู ููุงุชูุญ
   - ุจุฏูู ุจูุงูุงุช ุงุนุชูุงุฏ
   - ุงุชุตุงู ุนุจุฑ Railway ููุท

โ Railway Proxy (ุฌุณุฑ ุขูู):
   - ุฌููุน ุงูููุงุชูุญ ูู Environment Variables
   - SUPABASE_SERVICE_ROLE_KEY ูุญููุธ ููุง ููุท
   - ZOHO_EMAIL ู ZOHO_APP_PASSWORD ูุญููุธุฉ ููุง ููุท

โ Supabase Database:
   - ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุท
   - ูุง ุงุชุตุงูุงุช ูุจุงุดุฑุฉ ูู ุงูุนููู
```

ุงุณุชุฎุฏู **Environment Variables ูู Railway ููุท** (ููุณ ูู ุงูุนููู):
```bash
# ูุง ุชุถุน ูุฐุง ูู ุงูุฌูุงุฒ ุงููุญูู:
setx SUPABASE_SERVICE_ROLE_KEY "..."  # โ ูุง ุชูุนู ูุฐุง

# ูุฌุจ ุฃู ูููู ูู Railway Dashboard ููุท:
# Settings โ Environment Variables
```

ุชุญูู ูู ุงูุดุฑูุท (Session 30 P2):
- โ **ูุง ุชูุฌุฏ ููุงุชูุญ ูู `appsettings.json`**
- โ **ูุง ุชูุฌุฏ ูููุงุช ูุฑูุฑ ูู ุงูููุฏ**
- โ **`.gitignore` ูุณุชุซูู ุงููููุงุช ุงูุญุณุงุณุฉ** (ุชู ุชุญุฏูุซู)
- โ **ูุง ุงุณุชุฎุฏุงู `Environment.GetEnvironmentVariable()` ูู WPF**
- โ **ุฌููุน ุงูุงุชุตุงูุงุช ุนุจุฑ Railway Proxy HTTP ููุท**
- โ **`MacroFortSecureCredentialsManager` ุชู ุญุฐููุง**
- โ **ุฌููุน ุงููููุงุช legacy ูุน credentials ุชู ุญุฐููุง**

---

## ๐ ูุนูููุงุช ุงูุงุชุตุงู ูุงูุฏุนู ุงูููู

### ุนูุฏ ูุงุฌูุฉ ูุดููุฉ
| ุงููุดููุฉ | ุงูุญู | ุงููุฑุฌุน |
|--------|------|---------|
| ุฎุทุฃ ูู ุงุชุตุงู Supabase | ุชุญูู ูู SUPABASE_SERVICE_ROLE_KEY | Supabase Dashboard |
| ูู ูุตู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู | ุชุญูู ูู Zoho SMTP logs | Zoho Mail Admin |
| OTP ูุง ูุนูู | ุชุญูู ูู Debug Output | Event Viewer ุฃู Console |
| Device Transfer ูููู | ุชุญูู ูู device_transfer_count ู ุขุฎุฑ ุชุงุฑูุฎ | ูุงุนุฏุฉ ุงูุจูุงูุงุช |

---

## ๐ ููุทุฉ ุงูุชููู ุงูุญุงููุฉ (Checkpoint - Session 30 Portion 2)

### ูุง ุชู ุฅูุฌุงุฒู ูู Session 30 Portion 2:
โ **Security Hardening - Comprehensive Audit**
- ุงูุชุดุงู ูุญุฐู 4 ูููุงุช legacy ูุน baked-in credentials
- ุชุญุฏูุซ 61+ API calls ููุงุณุชุฎุฏุงู ุงูุขูู ุนุจุฑ Railway Proxy
- ุฅุฒุงูุฉ ุฌููุน ุงูุญููู ุงูุฎุทุฑุฉ (Credentials Manager, Credentials)
- Build: 0 errorsุ 0 warnings (ุบูุฑ ุญุฑุฌุฉ)

โ **Architecture Enforcement (Three-Tier Security)**
- TIER 1: Local WPF App โ ุจุฏูู ููุงุชูุญ ุฃู ุจูุงูุงุช ุงุนุชูุงุฏ
- TIER 2: Railway Proxy โ ุฌููุน ุงูููุงุชูุญ ููุง ููุท
- TIER 3: Supabase Database โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุท
- ุฌููุน ุงูุงุชุตุงูุงุช ุนุจุฑ Railway ููุท

โ **Repository Initialization**
- git init ูุญูู ูููุณุฎ ุงูุงุญุชูุงุทูุฉ
- commit ูุงุญุฏ ุดุงูู: "Security update for Railway proxy architecture"
- ูุฑุงุฑ ุงูุชุทููุฑ: ูุญูู ููุท (ูุง GitHub ููุนููู)

โ **Documentation Update**
- ุชุญุฏูุซ info.md ุจูู ุงููุนูููุงุช ุงูุฌุฏูุฏุฉ
- ุชูุซูู ุงูุจููุฉ ุงูุขููุฉ
- ุชูุซูู ูุฑุงุฑ ุงูุชุทููุฑ ุงููุญูู

### ุงูุฎุทูุฉ ุงูุชุงููุฉ ุงููุชููุนุฉ (Session 31+):
โณ ุงุฎุชุจุงุฑ ุงููุธุงู ูุงููุงู ุจุนุฏ ุงูุชุญุฏูุซุงุช ุงูุฃูููุฉ
โณ ุงูุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃู ูุดุงูู ูู ุงูุชูุนูู ูุงูุงุดุชุฑุงูุงุช
โณ ุงุฎุชุจุงุฑ ููู ุงูุฌูุงุฒ ูุงูุชุฌุฑุจุฉ ุงููุฌุงููุฉ
โณ ุงุฎุชุจุงุฑ OTP ูููุน ุงูุณุจุงู

### ูููุงุช ูููุฉ ูููุฑุฌุน:
- `MacroFortActivationService.cs` - ุงูุฎุฏูุฉ ุงูุฃุณุงุณูุฉ (ุขููุฉ)
- `migration_fix_subscription_code_status.sql` - ููุงุฑุฏ ุงูุจูุงูุงุช
- `SUBSCRIPTION_CODE_STATUS_FIX_GUIDE.md` - ุฏููู ุงูุงุดุชุฑุงูุงุช
- ูุฐุง ุงูููู (`info.md`) - ูุฑุฌุน ุดุงูู ูุญุงูุฉ ุงููุดุฑูุน

---

**ุขุฎุฑ ุชุญุฏูุซ**: 2025-12-21 (Session 30 P2 - Security Hardening & Railway-Only Architecture)  
**ุญุงูุฉ ุงููุดุฑูุน**: โ ุขูู 100% ูููุฏ ุงูุชุทููุฑ ุงููุดุท  
**ุงูุญุงูุฉ ุงูุฃูููุฉ**: ๐๐๐ ุขูู ุฌุฏุงู - ุฌููุน ุงูููุงุชูุญ ูู Railway ููุท (zero exposure)  
**ููุท ุงูุชุทููุฑ**: ูุญูู ููุท (local-only development)  
**ุขุฎุฑ ุชุญุฏูุซ ุญุฑุฌ**: Security Hardening (ุงูุชุดุงู ูุงุณุชุฆุตุงู 4 ูููุงุช ุฎุทุฑุฉ + ุชุญุฏูุซ 61+ API calls)

